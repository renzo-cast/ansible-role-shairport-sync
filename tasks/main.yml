# - name: Check if already installed
#   shell: shairport-sync -V
#   register: command_check

# - name: Confirm to re-install or downgrade
#   pause:
#     prompt: "The following version of shairport-sync in installed:\n{{ command_check.stdout }}\nAre you sure you want to continue? (yes/no)"
#   register: confirmation

# - name: continue or not?
#   fail:
#     msg: "User has stopped the installation"
#   when: confirmation == "no"

# - name: Check prerequisites
#   include_tasks: prerequisites.yml

# # update system
# # sudo apt-get update
# # sudo apt-get upgrade
# - name: update
#   include_tasks: update.yml

# # disable wifi power saving
# # sudo iwconfig wlan0 power off
# - name: Turn off wifi power-saving
#   shell: iwconfig wlan0 power off
#   become: true

# - name: Remove existing shairport-sync files
#   block:
#     # remove old scripts
#     # location=$(which shairport-sync)
#     # sudo rm $location
#     - name: Find old shairport-sync command
#       shell: which shairport-sync
#       become: true
#       register: command_locations

#     - name: Remove old shairport-sync commands
#       ansible.builtin.file:
#         path: "{{ item }}"
#         state: absent
#       with_items: command_locations

#     # 5. Cleanup
#     # sudo rm /etc/systemd/system/shairport-sync.service
#     # sudo rm /etc/init.d/shairport-sync
#     - name: Remove old shairport-sync service files
#       ansible.builtin.file:
#         path: "{{ item }}"
#         state: absent
#       with_items:
#         - "/etc/systemd/system/shairport-sync.service"
#         - "/etc/init.d/shairport-sync"

# # 6. REBOOT
# - name: reboot
#   reboot:
#   become: true

# # Install Shairport-sync
# # git clone https://github.com/mikebrady/shairport-sync.git
# # git checkout development
# - name: Git clone shairport-sync
#   ansible.builtin.git:
#     repo: 'https://github.com/mikebrady/shairport-sync.git'
#     dest: /tmp/shairport-sync
#     version: "{{ version }}"

# - name: install shairport-sync - AirPlay 1
#   include_tasks: airplay1.yml
#   when: airplay_version == 1

# - name: install shairport-sync - AirPlay 2
#   include_tasks: airplay2.yml
#   when: airplay_version == 2

- name: configure
  include_tasks: configure.yml

# # systemctl enable shairport-sync
# - name: systemctl enable shairport-sync
#   ansible.builtin.systemd:
#     name: shairport-sync
#     enabled: yes
#   become: true

# # systemctl start shairport-sync
# - name: systemctl start shairport-sync
#   ansible.builtin.systemd:
#     name: shairport-sync
#     state: started
#   become: true
